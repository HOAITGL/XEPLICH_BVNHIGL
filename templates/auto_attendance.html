{% extends "layout.html" %}
{% block title %}Táº¡o báº£ng cháº¥m cÃ´ng tá»± Ä‘á»™ng{% endblock %}
{% block content %}

<h2>ğŸ—“ï¸ Táº¡o báº£ng cháº¥m cÃ´ng tá»± Ä‘á»™ng</h2>

<form method="POST" id="attendanceForm">
  <div class="mb-3">
    <label for="department">Chá»n khoa:</label>
    <select name="department" id="department" class="form-select" required>
      <option value="">-- Chá»n khoa --</option>
      {% for d in departments %}
        <option value="{{ d }}" {% if d == selected_department %}selected{% endif %}>{{ d }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3 d-flex gap-3">
    <div>
      <label for="start_date">Tá»« ngÃ y:</label>
      <input type="date" name="start_date" id="start_date" class="form-control" required>
    </div>
    <div>
      <label for="end_date">Äáº¿n ngÃ y:</label>
      <input type="date" name="end_date" id="end_date" class="form-control" required>
    </div>
  </div>

  <div class="mb-3">
    <label for="shift_code">Chá»n ca lÃ m ngÃ y:</label>
    <select name="shift_code" id="shift_code" class="form-select" required>
      {% for shift in day_shifts %}
        <option value="{{ shift.code }}">{{ shift.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label>Chá»n nhÃ¢n viÃªn lÃ m ngÃ y:</label>
    <div class="d-flex flex-wrap gap-2">
      {% if users %}
        {% for staff in users %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="staff_ids" value="{{ staff.id }}" id="staff{{ staff.id }}">
            <label class="form-check-label" for="staff{{ staff.id }}">{{ staff.name }} ({{ staff.position }})</label>
          </div>
        {% endfor %}
      {% else %}
        <p>ChÆ°a cÃ³ nhÃ¢n viÃªn nÃ o trong khoa nÃ y.</p>
      {% endif %}
    </div>
  </div>

  <button type="submit" class="btn btn-primary">Cháº¥m cÃ´ng</button>
</form>

<script>
  // Náº¿u muá»‘n tá»± Ä‘á»™ng submit form khi chá»n khoa (Ä‘á»ƒ load láº¡i trang vá»›i nhÃ¢n viÃªn theo khoa)
  document.getElementById('department').addEventListener('change', function() {
    // Gá»­i GET request Ä‘á»ƒ táº£i láº¡i trang vá»›i tham sá»‘ khoa Ä‘Æ°á»£c chá»n
    const selected = this.value;
    if(selected) {
      window.location.href = '{{ url_for("auto_attendance_page") }}?department=' + encodeURIComponent(selected);
    } else {
      window.location.href = '{{ url_for("auto_attendance_page") }}';
    }
  });
</script>

{% endblock %}
