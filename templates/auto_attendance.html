{% extends "layout.html" %}
{% block title %}T·∫°o b·∫£ng ch·∫•m c√¥ng t·ª± ƒë·ªông{% endblock %}
{% block content %}

<h2>üóìÔ∏è T·∫°o b·∫£ng ch·∫•m c√¥ng t·ª± ƒë·ªông</h2>

<form method="POST" id="attendanceForm">
  <div class="mb-3">
    <label for="department">Ch·ªçn khoa:</label>
    <select name="department" id="department" class="form-select" required>
      <option value="">-- Ch·ªçn khoa --</option>
      {% for d in departments %}
        <option value="{{ d }}" {% if d == selected_department %}selected{% endif %}>{{ d }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3 d-flex gap-3">
    <div>
      <label for="start_date">T·ª´ ng√†y:</label>
      <input type="date" name="start_date" id="start_date" class="form-control" required>
    </div>
    <div>
      <label for="end_date">ƒê·∫øn ng√†y:</label>
      <input type="date" name="end_date" id="end_date" class="form-control" required>
    </div>
  </div>

  <div class="mb-3">
    <label for="shift_code">Ch·ªçn ca l√†m ng√†y:</label>
    <select name="shift_code" id="shift_code" class="form-select" required>
      {% for shift in day_shifts %}
        <option value="{{ shift.code }}">{{ shift.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label>Ch·ªçn nh√¢n vi√™n l√†m ng√†y:</label>
    {% if users %}
      <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="selectAll">
        <label class="form-check-label" for="selectAll">Ch·ªçn t·∫•t c·∫£</label>
      </div>
      <div class="d-flex flex-wrap gap-2">
        {% for staff in users %}
          <div class="form-check">
            <input class="form-check-input staff-checkbox" type="checkbox" name="staff_ids" value="{{ staff.id }}" id="staff{{ staff.id }}">
            <label class="form-check-label" for="staff{{ staff.id }}">{{ staff.name }} ({{ staff.position }})</label>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>Ch∆∞a c√≥ nh√¢n vi√™n n√†o trong khoa n√†y.</p>
    {% endif %}
  </div>

  <button type="submit" class="btn btn-primary">Ch·∫•m c√¥ng</button>
</form>

<script>
  document.getElementById('department').addEventListener('change', function() {
    const selected = this.value;
    if(selected) {
      window.location.href = '{{ url_for("auto_attendance_page") }}?department=' + encodeURIComponent(selected);
    } else {
      window.location.href = '{{ url_for("auto_attendance_page") }}';
    }
  });

  const selectAllCheckbox = document.getElementById('selectAll');
  if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function () {
      const checkboxes = document.querySelectorAll('.staff-checkbox');
      checkboxes.forEach(cb => cb.checked = this.checked);
    });
  }
</script>

{% endblock %}
