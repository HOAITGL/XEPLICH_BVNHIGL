{% extends 'layout.html' %}
{% block content %}

<h4 class="fw-bold text-center my-3">
  B·∫¢NG THANH TO√ÅN TI·ªÄN TR·ª∞C TH√ÅNG {{ thang }}/{{ nam }}
</h4>

<div class="d-flex gap-2 mb-3 flex-wrap">
  <a href="/export-shift-payment-all?mode={{ mode }}&department={{ selected_department }}&start_date={{ start_date }}&end_date={{ end_date }}"
     class="btn btn-success">‚¨áÔ∏è Xu·∫•t Excel</a>

  <a href="/print-shift-payment?mode={{ mode }}&department={{ selected_department }}&start_date={{ start_date }}&end_date={{ end_date }}"
     class="btn btn-secondary" target="_blank">üñ®Ô∏è In b·∫£ng</a>

  {% if selected_department == 'all' %}
  <a href="/print-shift-payment-summary?mode={{ mode }}&start_date={{ start_date }}&end_date={{ end_date }}"
     class="btn btn-dark" target="_blank">üñ®Ô∏è In b·∫£ng t·ªïng h·ª£p</a>
  {% endif %}
</div>

<form method="GET" action="/shift-payment-view" class="mb-3 d-flex gap-3 flex-wrap align-items-end">
  <div>
    <label for="department">Khoa/Ph√≤ng:</label>
    <select name="department" class="form-select">
      <option value="all">T·∫•t c·∫£</option>
      {% for dept in departments %}
        <option value="{{ dept }}" {% if dept == selected_department %}selected{% endif %}>{{ dept }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label for="mode">Ch·∫ø ƒë·ªô:</label>
    <select name="mode" class="form-select">
      <option value="16h" {% if mode == '16h' %}selected{% endif %}>T√≠nh theo gi·ªù 16h</option>
      <option value="24h" {% if mode == '24h' %}selected{% endif %}>T√≠nh theo ca 24h</option>
    </select>
  </div>

  <div>
    <label for="start_date">T·ª´ ng√†y:</label>
    <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
  </div>

  <div>
    <label for="end_date">ƒê·∫øn ng√†y:</label>
    <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
  </div>

  <button type="submit" class="btn btn-primary">L·ªçc</button>
</form>

<table class="table table-bordered table-sm text-center align-middle">
  <thead class="table-light">
    <tr>
      <th rowspan="2">STT</th>
      <th rowspan="2">H·ªå T√äN</th>
      <th colspan="2">Tr·ª±c ng√†y th∆∞·ªùng</th>
      <th colspan="2">Tr·ª±c ng√†y ngh·ªâ</th>
      <th colspan="2">Tr·ª±c ng√†y l·ªÖ</th>
      <th rowspan="2">T·ªïng s·ªë<br>ng√†y tr·ª±c</th>
      <th rowspan="2">Th√†nh ti·ªÅn<br>Qƒê 73</th>
      <th rowspan="2">Ti·ªÅn ƒÉn<br>(15k/ng√†y)</th>
      <th rowspan="2">T·ªïng c·ªông</th>
      <th rowspan="2">Ghi ch√∫</th>
    </tr>
    <tr>
      <th>Th∆∞·ªùng</th>
      <th>HSCC</th>
      <th>Th∆∞·ªùng</th>
      <th>HSCC</th>
      <th>Th∆∞·ªùng</th>
      <th>HSCC</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td>{{ loop.index }}</td>
      <td class="text-start">{{ row.user.name }}</td>
      <td>{{ row.detail[('th∆∞·ªùng', 'ng√†y_th∆∞·ªùng')].so_ngay }}</td>
      <td>{{ row.detail[('HSCC', 'ng√†y_th∆∞·ªùng')].so_ngay }}</td>
      <td>{{ row.detail[('th∆∞·ªùng', 'ng√†y_ngh·ªâ')].so_ngay }}</td>
      <td>{{ row.detail[('HSCC', 'ng√†y_ngh·ªâ')].so_ngay }}</td>
      <td>{{ row.detail[('th∆∞·ªùng', 'ng√†y_l·ªÖ')].so_ngay }}</td>
      <td>{{ row.detail[('HSCC', 'ng√†y_l·ªÖ')].so_ngay }}</td>
      <td>{{ row.tong_ngay }}</td>
      <td>{{ "{:,.0f}".format(row.tien_ca).replace(",", ".") }}</td>
      <td>{{ "{:,.0f}".format(row.tien_an).replace(",", ".") }}</td>
      <td>{{ "{:,.0f}".format(row.tong_tien).replace(",", ".") }}</td>
      <td>{% if row.is_contract %}HD{% endif %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
