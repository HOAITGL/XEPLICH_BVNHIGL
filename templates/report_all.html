{% extends 'layout.html' %}
{% block title %}Tá»•ng há»£p lá»‹ch trá»±c toÃ n viá»‡n{% endblock %}

{% block content %}

<!-- PHáº¦N TIÃŠU Äá»€ KHI IN -->
<div class="d-none d-print-block text-center mb-3">
  <div class="row">
    <div class="col-6 text-center fw-bold">
      Bá»†NH VIá»†N NHI Tá»ˆNH GIA LAI<br>
      <span style="border-bottom: 1px solid;">PHÃ’NG KHTH - CNTT</span>
    </div>
    <div class="col-6 text-center fw-bold">
      Cá»˜NG HÃ’A XÃƒ Há»˜I CHá»¦ NGHÄ¨A VIá»†T NAM<br>
      <span style="border-bottom: 1px solid;">Äá»™c láº­p - Tá»± do - Háº¡nh phÃºc</span><br>
      <em>Gia Lai, ngÃ y {{ start_date.strftime('%d') }} thÃ¡ng {{ start_date.strftime('%m') }} nÄƒm {{ start_date.strftime('%Y') }}</em>
    </div>
  </div>
</div>

<!-- TIÃŠU Äá»€ Báº¢NG -->
<div class="text-center mb-3 d-print-block">
  <h5><strong>Báº¢NG PHÃ‚N TRá»°C TUáº¦N</strong></h5>
  <p>Tá»« ngÃ y {{ start_date.strftime('%d/%m/%Y') }} Ä‘áº¿n {{ end_date.strftime('%d/%m/%Y') }}</p>
</div>

<!-- FORM Lá»ŒC -->
<form method="get" class="d-flex gap-3 mb-3 d-print-none">
  <div>
    <label class="form-label mb-0">Tá»« ngÃ y:</label>
    <input type="date" name="start" class="form-control" value="{{ start_date }}">
  </div>
  <div>
    <label class="form-label mb-0">Äáº¿n ngÃ y:</label>
    <input type="date" name="end" class="form-control" value="{{ end_date }}">
  </div>
  <button type="submit" class="btn btn-primary">Lá»c</button>
  <a href="/export-report-all?start={{ start_date }}&end={{ end_date }}" class="btn btn-success">ğŸ“¥ Xuáº¥t Excel</a>
  <button type="button" class="btn btn-secondary" onclick="window.print()">ğŸ–¨ In Lá»‹ch Trá»±c</button>
</form>

<!-- Báº¢NG Dá»® LIá»†U -->
<div class="table-scroll">
<table class="table table-bordered text-center">
  <thead class="table-dark">
    <tr>
      <th>STT</th>
      <th>Khoa/PhÃ²ng</th>
      {% for d in date_range %}
        <th>{{ d.strftime('%a %d/%m') }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for dept in dept_ordered %}
    <tr>
      <td>{{ loop.index }}</td>
      <td><strong>{{ dept }}</strong></td>
      {% for d in date_range %}
        {% set key = d.strftime('%a %d/%m') %}
        <td>
          {% set items = grouped_by_dept[dept].get(key, []) %}
          {% for position, line in items %}
            {{ line }}<br>
          {% endfor %}
        </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>

<!-- CHÃ‚N TRANG IN NGAY SAU Báº¢NG -->
<div class="d-none d-print-block mt-2" style="margin-top: 8px;">
  <div class="row">
    <div class="col-4">
      <strong>NÆ¡i nháº­n:</strong><br>
      - Ban GiÃ¡m Ä‘á»‘c<br>
      - CÃ¡c khoa/phÃ²ng<br>
      - ÄÄƒng website<br>
      - LÆ°u: VP, KH-CNTT
    </div>
    <div class="col-4 text-center">
      <strong>NGÆ¯á»œI Láº¬P Báº¢NG</strong><br>
      <em>(KÃ½, ghi rÃµ há» tÃªn)</em>
    </div>
    <div class="col-4 text-center">
      <strong>GIÃM Äá»C</strong><br>
      <em>(KÃ½, ghi rÃµ há» tÃªn)</em>
    </div>
  </div>
</div>

<!-- CSS IN áº¤N -->
<style>
@media print {
  .d-print-block { display: block !important; }
  .d-print-none, .btn, .sidebar, form, nav, .print-hide, .user-greeting {
    display: none !important;
  }

  html, body {
    zoom: 100%;
    margin: 0 !important;
    padding: 0 !important;
    width: 100%;
    height: 100%;
  }

  .container, .row, .main, .wrapper, .content {
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  table {
    width: 100% !important;
    table-layout: auto;
    border-collapse: collapse;
    font-size: 13px;
  }

  th, td {
    padding: 6px;
    border: 1px solid black;
    text-align: center;
    vertical-align: top;
    line-height: 1.3;
    height: 60px;
    word-break: break-word;
  }

  .fst-italic {
    font-style: italic;
  }
}

@page {
  size: A4 landscape;
  margin: 1cm 1cm 1cm 2cm;
}
</style>

{% endblock %}
