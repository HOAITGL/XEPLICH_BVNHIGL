<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>S·ª≠a c·∫•u h√¨nh ƒë·ªôc h·∫°i</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">S·ª≠a c·∫•u h√¨nh m·ª©c ƒë·ªôc h·∫°i</h2>
        <a href="/hazard-config" class="btn btn-secondary">‚Ü© Quay l·∫°i</a>
    </div>

    <form method="post" class="row g-3 border p-3 rounded" autocomplete="off">
        <!-- Khoa -->
        <div class="col-md-4">
            <label class="form-label">Khoa</label>
            <select name="department" class="form-select" required>
                {% for d in departments %}
                <option value="{{ d.name }}" {% if d.name == config.department %}selected{% endif %}>
                    {{ d.name }}{% if d.is_lab %} (XN){% endif %}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Ch·ª©c v·ª• -->
        <div class="col-md-2">
            <label class="form-label">Ch·ª©c v·ª• √°p d·ª•ng</label>
            <input type="text" name="position" class="form-control"
                   value="{{ config.position or '' }}" placeholder="VD: HL, DD, BS">
            <small class="text-muted">ƒê·ªÉ tr·ªëng n·∫øu √°p d·ª•ng cho m·ªçi ch·ª©c v·ª•</small>
        </div>

        <!-- Lo·∫°i m√°y -->
        <div class="col-md-3">
            <label class="form-label">Lo·∫°i m√°y</label>
            <select name="machine_type" class="form-select">
                {% for val, label in machine_types %}
                <option value="{{ val }}" {% if (config.machine_type or '') == val %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>
            <small class="text-muted">ƒê·ªÉ tr·ªëng (ch·ªçn ‚ÄúT·∫•t c·∫£ m√°y‚Äù) n·∫øu kh√¥ng ph√¢n bi·ªát</small>
        </div>

        <!-- M·ª©c ƒë·ªôc h·∫°i -->
        <div class="col-md-3">
            <label class="form-label">M·ª©c ƒë·ªôc h·∫°i</label>
            <input type="number" step="0.01" name="hazard_level" class="form-control"
                   value="{{ config.hazard_level }}" required>
        </div>

        <!-- ƒê∆°n v·ªã -->
        <div class="col-md-2">
            <label class="form-label">ƒê∆°n v·ªã</label>
            <select name="unit" id="unit" class="form-select" required>
                <option value="%" {% if config.unit == '%' %}selected{% endif %}>%</option>
                <option value="ngay" {% if config.unit == 'ngay' %}selected{% endif %}>Ng√†y</option>
                <option value="gio" {% if config.unit == 'gio' %}selected{% endif %}>Gi·ªù</option>
            </select>
            <small class="text-muted">H·ªá th·ªëng ch·∫•p nh·∫≠n %, ng√†y ho·∫∑c gi·ªù</small>
        </div>

        <!-- S·ªë gi·ªù t√≠nh -->
        <div class="col-md-2">
            <label class="form-label">S·ªë gi·ªù t√≠nh</label>
            <input type="number" step="0.1" name="duration_hours" id="duration_hours" class="form-control"
                   value="{{ config.duration_hours }}" required>
        </div>

        <!-- T√πy ch·ªçn Th·ª© 7/CN -->
        <div class="col-md-3">
            <label class="form-label">T√πy ch·ªçn Th·ª© 7/CN</label>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="weekend_only" id="weekend_only">
                <label class="form-check-label" for="weekend_only">√Åp d·ª•ng ri√™ng cho Th·ª© 7/CN</label>
            </div>
            <div id="weekend_part_wrap" style="display:none; margin-top:8px;">
                <select name="weekend_part" id="weekend_part" class="form-select">
                    <option value="full">C·∫£ ng√†y (17h)</option>
                    <option value="half">N·ª≠a ng√†y (7h)</option>
                </select>
            </div>
            <small class="text-muted d-block mt-1">
                Khi b·∫≠t, h·ªá th·ªëng s·∫Ω √©p ƒë∆°n v·ªã = Gi·ªù v√† s·ªë gi·ªù = 17 ho·∫∑c 7.
            </small>
        </div>

        <!-- T·ª´ ng√†y -->
        <div class="col-md-3">
            <label class="form-label">T·ª´ ng√†y</label>
            <input type="date" name="start_date" class="form-control"
                   value="{{ config.start_date.strftime('%Y-%m-%d') if config.start_date else '' }}" required>
        </div>

        <!-- ƒê·∫øn ng√†y -->
        <div class="col-md-3">
            <label class="form-label">ƒê·∫øn ng√†y</label>
            <input type="date" name="end_date" class="form-control"
                   value="{{ config.end_date.strftime('%Y-%m-%d') if config.end_date else '' }}" required>
        </div>

        <div class="col-12">
            <button type="submit" class="btn btn-primary">üíæ C·∫≠p nh·∫≠t</button>
        </div>
    </form>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const weekendOnly = document.getElementById('weekend_only');
        const weekendPartWrap = document.getElementById('weekend_part_wrap');
        const weekendPart = document.getElementById('weekend_part');
        const unitSelect = document.getElementById('unit');
        const hoursInput = document.getElementById('duration_hours');

        function syncWeekendUI() {
          if (weekendOnly.checked) {
            weekendPartWrap.style.display = 'block';
            if (unitSelect) unitSelect.value = 'gio';
            if (hoursInput) hoursInput.value = (weekendPart.value === 'full') ? '17' : '7';
          } else {
            weekendPartWrap.style.display = 'none';
          }
        }

        weekendOnly?.addEventListener('change', syncWeekendUI);
        weekendPart?.addEventListener('change', syncWeekendUI);
      });
    </script>
</body>
</html>
