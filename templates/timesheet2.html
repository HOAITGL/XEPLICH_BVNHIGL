{% extends "base.html" %}
{% block content %}
<h2>B·∫£ng ch·∫•m c√¥ng 2</h2>

<!-- Form t·∫°o b·∫£ng m·ªõi -->
<form method="post" class="mb-3" style="margin-bottom:16px;">
  <label>T√™n b·∫£ng</label>
  <input type="text" name="name" placeholder="B·∫£ng ch·∫•m c√¥ng 2">
  <label>Khoa/Ph√≤ng</label>
  <select name="department" required>
    {% for d in departments %}
      <option value="{{ d }}">{{ d }}</option>
    {% endfor %}
  </select>
  <label>T·ª´ ng√†y</label>
  <input type="date" name="start_date" required>
  <label>ƒê·∫øn ng√†y</label>
  <input type="date" name="end_date" required>
  <button type="submit">T·∫°o b·∫£ng tr·ªëng</button>
</form>

<!-- Form sao ch√©p t·ª´ Schedule -->
<form method="post" action="/timesheet2/create-from-schedule" class="mb-3" style="margin-bottom:24px;">
  <strong>T·∫°o b·∫±ng c√°ch sao ch√©p t·ª´ l·ªãch (Schedule):</strong><br>
  <input type="text" name="name" placeholder="B·∫£ng ch·∫•m c√¥ng 2 (sao ch√©p)">
  <select name="department" required>
    {% for d in departments %}
      <option value="{{ d }}">{{ d }}</option>
    {% endfor %}
  </select>
  <input type="date" name="start_date" required>
  <input type="date" name="end_date" required>
  <button type="submit">Sao ch√©p</button>
</form>

<!-- Toolbar -->
<div style="display:flex; gap:8px; justify-content:flex-end; margin:10px 0;">
  <button id="btnReload" type="button"
          style="padding:8px 12px; border:1px solid #ccc; background:#f8f8f8; cursor:pointer; border-radius:6px;">
    üîÑ Xem l·∫°i
  </button>
</div> <!-- ‚úÖ ƒë√≥ng div -->

<!-- B·∫£ng danh s√°ch timesheet2 -->
<div id="ts2-list">
  <table border="1" cellpadding="6" style="border-collapse: collapse; width:100%;">
    <tr>
      <th>ID</th>
      <th>T√™n</th>
      <th>Khoa</th>
      <th>Kho·∫£ng ng√†y</th>
      <th>M·ªü</th>
    </tr>
    {% for s in sheets %}
      <tr>
        <td>{{ s.id }}</td>
        <td>{{ s.name }}</td>
        <td>{{ s.department }}</td>
        <td>{{ s.start_date }} ‚Üí {{ s.end_date }}</td>
        <td><a href="/timesheet2/{{ s.id }}">M·ªü</a></td>
      </tr>
    {% endfor %}
  </table>
</div>

<script>
document.getElementById('btnReload').addEventListener('click', function () {
  fetch('/timesheet2', { method: 'GET', headers: { 'X-Requested-With': 'fetch' } })
    .then(r => r.text())
    .then(html => {
      const doc = new DOMParser().parseFromString(html, 'text/html');
      const newTable = doc.querySelector('#ts2-list');
      if (newTable) {
        document.querySelector('#ts2-list').innerHTML = newTable.innerHTML;
      }
    })
    .catch(console.error);
});
</script>
{% endblock %}
